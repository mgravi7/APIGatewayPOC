# APIGatewayPOC - Copilot Instructions

## Project Overview
This is a proof-of-concept microservices application demonstrating API Gateway patterns using Envoy as the gateway and FastAPI for microservices.

## Architecture
- **API Gateway**: Envoy proxy handling routing, load balancing, and cross-cutting concerns
- **Customer Service**: FastAPI microservice for customer management
- **Product Service**: FastAPI microservice for product management
- **Containerization**: Docker & Docker Compose for orchestration

## Development Guidelines

### Code Style & Standards
- Use Python 3.11+ with FastAPI framework
- Follow PEP 8 style guidelines
- Use Pydantic models for data validation
- Include comprehensive docstrings for all functions
- Use type hints throughout the codebase

### API Design Principles
- RESTful API design patterns
- Consistent error handling and HTTP status codes
- Health check endpoints on all services (`/health`)
- Proper request/response models with Pydantic
- Version APIs appropriately

### Docker & Deployment
- Use multi-stage Docker builds where appropriate
- Keep Docker images minimal and secure
- Use non-root users in containers
- Implement proper environment variable handling
- Include health checks in Docker containers

### Testing Strategy
- Unit tests for business logic
- Integration tests for API endpoints
- End-to-end tests through the API Gateway
- Use pytest framework
- Mock external dependencies appropriately

### Project Structure
```
services/
??? gateway/          # Envoy API Gateway configuration
??? customer-service/ # Customer management microservice
??? product-service/  # Product management microservice
??? shared/           # Shared utilities and common code
```

### Environment Setup
1. Ensure Docker Desktop is installed and running
2. Use `docker-compose up --build` to start all services
3. API Gateway accessible at `http://localhost:8080`
4. Envoy admin interface at `http://localhost:9901`

### Development Workflow
1. Make changes to service code
2. Run tests locally: `pytest tests/`
3. Build and test with Docker: `docker-compose up --build`
4. Test endpoints through the API Gateway
5. Check logs and monitoring

### Service Endpoints
- **Customer Service**: 
  - `GET /customers` - List all customers
  - `GET /customers/{id}` - Get customer by ID
  - `GET /health` - Health check
- **Product Service**: 
  - `GET /products` - List all products
  - `GET /products/{id}` - Get product by ID
  - `GET /products/category/{category}` - Get products by category
  - `GET /health` - Health check

### Gateway Routing
- `/customers/*` ? Customer Service
- `/products/*` ? Product Service
- `/customer-service/*` ? Customer Service (alternative route)
- `/product-service/*` ? Product Service (alternative route)

### Future Enhancements (Roadmap)
1. **Database Integration**: Add PostgreSQL for data persistence
2. **CRUD Operations**: Implement POST, PUT, DELETE endpoints
3. **Authentication**: JWT tokens with Keycloak integration
4. **Monitoring**: Jaeger tracing and Prometheus metrics
5. **Rate Limiting**: Implement in Envoy gateway
6. **Caching**: Redis for improved performance
7. **CI/CD Pipeline**: Automated testing and deployment
8. **Frontend**: React-based user interface

### Common Development Tasks
- **Adding new service**: Create in `services/` with Dockerfile, requirements.txt, main.py
- **Adding new endpoint**: Update FastAPI app and corresponding Pydantic models
- **Gateway routing**: Update `services/gateway/envoy.yaml` configuration
- **Database changes**: Update models and add migration scripts
- **Testing**: Add tests in `tests/` directory with appropriate fixtures

### Troubleshooting
- Check service logs: `docker-compose logs [service-name]`
- Verify Envoy configuration: `http://localhost:9901`
- Test services directly: Customer (8001), Product (8002)
- Rebuild containers: `docker-compose down && docker-compose up --build`

### Security Considerations
- Never commit secrets or credentials
- Use environment variables for configuration
- Implement proper CORS policies
- Validate all input data with Pydantic
- Use HTTPS in production environments
- Implement rate limiting and request size limits

## Code Assistance Guidelines
When helping with this project:
1. Follow the established patterns and structure
2. Ensure Docker compatibility for all changes
3. Include appropriate tests for new functionality
4. Update this instruction file when adding new patterns
5. Consider the future roadmap when making architectural decisions
6. Always include proper error handling and logging
7. Maintain consistency across microservices